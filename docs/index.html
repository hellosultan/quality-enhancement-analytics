<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quality Enhancement Analytics</title>

  <!-- Fonts & libs -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.plot.ly/plotly-2.34.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <link  href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet"/>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

  <style>
    :root{
      --bg:#0b1020; --panel:#0f172a; --ink:#e5e7eb; --muted:#94a3b8;
      --ring:#1f2937; --accent:#60a5fa; --accent2:#a78bfa; --accent3:#34d399;
      --card:#111827; --shadow: 0 8px 30px rgba(2,6,23,.35);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:radial-gradient(1000px 600px at 10% -10%, #0b173b 0%, #0b1020 50%), var(--bg);color:var(--ink)}
    a{color:var(--accent);text-decoration:none}
    header.nav{
      position:sticky; top:0; z-index:10;
      backdrop-filter:saturate(140%) blur(10px);
      background:rgba(11,16,32,.7); border-bottom:1px solid rgba(99,102,241,.15);
      display:flex; align-items:center; justify-content:space-between; padding:12px 20px;
    }
    .brand{font-weight:800; letter-spacing:.3px}
    .nav-actions a{display:inline-block; padding:8px 12px; border:1px solid var(--ring); border-radius:12px; color:var(--ink); margin-left:8px}
    .nav-actions a.primary{background:linear-gradient(90deg, var(--accent), var(--accent2)); border:none; color:#081224; font-weight:700}

    .hero{
      max-width:1200px; margin:34px auto 22px; padding:0 18px;
      display:grid; grid-template-columns:1.2fr .8fr; gap:20px;
    }
    .hero-card{
      background:linear-gradient(180deg, rgba(96,165,250,.08), rgba(167,139,250,.05));
      border:1px solid rgba(96,165,250,.15); border-radius:18px; padding:24px; box-shadow:var(--shadow);
    }
    .hero h1{font-size:34px; margin:0 0 10px}
    .subtitle{color:var(--muted); font-size:15px; line-height:1.5}
    .pills{margin-top:12px}
    .pill{display:inline-block; padding:6px 10px; margin:4px 6px 0 0; border-radius:999px; font-size:12px; color:#0b1020; font-weight:700;
      background:linear-gradient(90deg, var(--accent3), var(--accent))}
    .hero-kpis{display:grid; grid-template-columns:repeat(3,1fr); gap:12px}
    .mini{background:var(--card); border:1px solid var(--ring); border-radius:14px; padding:14px; box-shadow:var(--shadow)}
    .mini .t{color:var(--muted); font-size:12px} .mini .v{font-size:24px; font-weight:800; margin-top:6px}

    main{max-width:1200px; margin:14px auto 60px; padding:0 18px}
    .section{margin-top:22px}
    .section h2{margin:0 0 10px; font-size:18px; letter-spacing:.2px}
    .grid{display:grid; grid-template-columns:1fr; gap:14px}
    @media(min-width:1100px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:var(--card); border:1px solid var(--ring); border-radius:16px; padding:16px; box-shadow:var(--shadow)}
    .card h3{margin:0 0 6px}
    .caption{color:var(--muted); font-size:12px; margin-top:8px}
    footer{max-width:1200px; margin:30px auto; padding:0 18px; color:var(--muted); font-size:12px}
    table.dataTable thead th{background:#0c1224;color:#cbd5e1;border-bottom:1px solid var(--ring)}
    .insight-copy{color:var(--muted); font-size:14px; line-height:1.55; margin:6px 0 12px}
    .callout{
  background:linear-gradient(180deg, rgba(96,165,250,.08), rgba(20,83,45,.06));
  border:1px solid rgba(96,165,250,.18);
  border-radius:16px; padding:16px;
  box-shadow: 0 6px 24px rgba(2,6,23,.25);
}
.callout h3{margin:0 0 8px; font-size:16px}
.callout p,.callout li{color:var(--muted); font-size:14px; line-height:1.6}
.callout .legend{display:flex; gap:10px; flex-wrap:wrap; margin:8px 0 2px}
.callout .legend .badge{background:#0d142a}
.badge-row{display:flex; gap:10px; flex-wrap:wrap; margin:6px 0 10px}
.badge{display:inline-flex; align-items:center; gap:8px; background:#0d142a; border:1px solid var(--ring);
  border-radius:999px; padding:6px 10px; font-size:12px; color:#cbd5e1}
.swatch{width:10px; height:10px; border-radius:3px; display:inline-block}
.swatch.red{background:crimson}
.swatch.green{background:seagreen}
.swatch.blue{background:#60a5fa}
  
  </style>
</head>
<body>

<header class="nav">
  <div class="brand">Quality Enhancement Analytics</div>
  <div class="nav-actions">
    <a href="https://github.com/hellosultan/quality-enhancement-analytics" target="_blank" rel="noopener">GitHub</a>
  </div>
</header>

<section class="hero">
  <div class="hero-card">
    <h1>AI‚Äëassisted QAA‚Äëaligned insights</h1>
    <p class="subtitle">End‚Äëto‚Äëend project showing synthetic data generation, cleaning, KPI analysis and visual narrative dashboards mapped to QAA UK themes (Assessment, Monitoring & Evaluation, Student Engagement).</p>
    <div class="pills">
      <span class="pill">Synthetic, RNG‚Äëseeded</span>
      <span class="pill">SQLite + pandas</span>
      <span class="pill">Plotly + DataTables</span>
    </div>
  </div>
  <div class="hero-kpis">
    <div class="mini"><div class="t">Overall pass rate</div><div class="v" id="kpiPass">‚Äî</div></div>
    <div class="mini"><div class="t">Assessments ‚â§15d</div><div class="v" id="kpiTurn">‚Äî</div></div>
    <div class="mini"><div class="t">Median engagement</div><div class="v" id="kpiEng">‚Äî</div></div>
  </div>
</section>

<!-- üìå How to read this dashboard callout -->
<div class="callout" style="max-width:1200px; margin:0 auto 14px; padding:16px 18px">
  <h3>How to read this dashboard</h3>
  <div class="legend">
  <span class="badge"><span class="swatch red"></span>Colour coding: Red = At-risk modules</span>
  <span class="badge"><span class="swatch green"></span>Green = Higher satisfaction</span>
  <span class="badge"><span class="swatch blue"></span>Blue = Programme/series marker</span>
</div>
  <p style="margin:6px 0 10px">
    <b>At-risk definition</b>: modules are flagged when both satisfaction and pass are below set thresholds.  
Figures 4‚Äì6 progressively zoom in: overall cluster (Fig 4), ‚â§ median engagement & pass (Fig 5), and ‚â§ median pass with satisfaction split (Fig 6).
  </p>
  <ul style="margin:6px 0 0 18px">
    <li><b>Fig 1</b> ‚Äî Pass rate trends by programme across terms (spot dips/divergence).</li>
    <li><b>Fig 2</b> ‚Äî Turnaround timeliness (QAA emphasis on prompt feedback).</li>
    <li><b>Fig 3</b> ‚Äî Engagement vs pass; bottom-left quadrant signals concern.</li>
    <li><b>Fig 4</b> ‚Äî Module health: survey satisfaction vs pass (red = at-risk).</li>
    <li><b>Fig 5</b> ‚Äî Only points ‚â§ medians on both engagement & pass (focus view).</li>
    <li><b>Fig 6</b> ‚Äî Only modules ‚â§ median pass, coloured by at-risk rule.</li>
  </ul>
</div>
<main>
  <div class="section">
    <h2>Assessment & Programme Monitoring</h2>
    <div class="grid">
      <div class="card">
  <h3>Programme Pass Rates by Term</h3>
  <div class="insight-copy">
    Tracks the pass rate (%) across terms for each programme. This helps identify
    trends in attainment and highlights divergence between disciplines over time.
  </div>
  <div class="badge-row">
    <span class="badge"><span class="swatch blue"></span>Each line = a programme</span>
  </div>
  <div id="fig1" style="height:360px"></div>
</div>
      <div class="card">
  <h3>Assessment Turnaround Distribution</h3>
  <div class="insight-copy">
    Bar chart showing how quickly assessments are returned. Timely feedback is a key QAA expectation.
  </div>
  <div class="badge-row">
    <span class="badge"><span class="swatch blue"></span>Each bar = assessments in turnaround bin</span>
  </div>
  <div id="fig2" style="height:360px"></div>
</div>
    </div>
  </div>

  <div class="section">
    <h2>Engagement & At‚Äërisk Lens</h2>
    <div class="grid">
      <div class="card">
  <h3>Engagement vs Pass Rate</h3>
  <div class="insight-copy">
  Scatter of engagement index vs pass rate. Bottom-left quadrant highlights programmes/terms
  with both low engagement and low attainment. Engagement index is scaled 1‚Äì5 from survey items.
</div>
  <div class="badge-row">
    <span class="badge"><span class="swatch blue"></span>Each dot = a programme / term</span>
  </div>
  <div id="fig3" style="height:360px"></div>
  <div class="caption">Each dot = a programme/term combination.</div>
</div>
      <div class="card">
  <h3>Modules: Pass vs Survey Satisfaction</h3>
  <div class="insight-copy">
    This scatterplot compares survey satisfaction against pass rates. 
    <b>Red dots</b> = modules flagged as ‚Äúat-risk‚Äù (low satisfaction & low pass rates). 
    <b>Green dots</b> = Higher satisfaction & better pass rates.
  </div>
  <div class="badge-row">
    <span class="badge"><span class="swatch red"></span>Low satisfaction & pass (at-risk)</span>
    <span class="badge"><span class="swatch green"></span>Higher satisfaction</span>
  </div>
  <div id="fig4" style="height:360px"></div>
</div>
      <div class="card">
  <h3>Medium-to-Low Engagement & Pass</h3>
  <div class="insight-copy">
    Focus view of programme/term points at or below the median on both engagement
    and pass rate. Dotted lines mark the medians.
  </div>
  <div class="badge-row">
    <span class="badge"><span class="swatch blue"></span>Each dot = a programme / term ‚â§ medians</span>
  </div>
  <div id="fig5" style="height:360px"></div>
</div>
     <div class="card">
  <h3>Modules with Medium‚Äëto‚ÄëLow Pass</h3>
  <div class="insight-copy">
    Shows modules at or below the median pass rate. <b>Red dots</b> mark those flagged as at‚Äërisk;
    <b>green dots</b> indicate relatively higher satisfaction within this low‚Äëpass group.
  </div>
  <div class="badge-row">
    <span class="badge"><span class="swatch red"></span>At‚Äërisk (within ‚â§ median pass)</span>
    <span class="badge"><span class="swatch green"></span>Higher satisfaction (within ‚â§ median pass)</span>
  </div>
  <div id="fig6" style="height:360px"></div>
</div>
    </div>
  </div>

  <div class="section">
    <div class="card">
      <h3>Module Summary</h3>
      <table id="modTable" class="display" style="width:100%"></table>
      <div class="caption">Source: <code>docs/data/*.csv</code>. All data are synthetic for demo.</div>
    </div>
  </div>
</main>

<footer>¬© 2025 ‚Äî Built with pandas & Plotly ¬∑ QAA-aligned synthetic demo (GitHub Pages)</footer>

<script>
(async function () {
  // ---- helpers ----
  const bust = (p) => p + (p.includes("?") ? "&" : "?") + "v=" + Date.now();
  const bottomLegend = () => ({ orientation:"h", y:-0.2, x:0.5, xanchor:"center", yanchor:"top" });

  const loadCSV = async (path) => new Promise((resolve, reject) => {
    Papa.parse(path, {
      download: true,
      header: true,
      dynamicTyping: true,
      skipEmptyLines: "greedy",
      transformHeader: (h) => (h || "").trim(),
      transform: (v) => (typeof v === "string" ? v.trim() : v),
      complete: (res) => resolve(res.data || []),
      error: reject
    });
  });

  // ---- load CSVs ----
  const base = "data/";
  let progPass = [], turn = [], eng = [], risk = [];
  [progPass, turn, eng, risk] = await Promise.all([
    loadCSV(bust(base + "kpi_pass_rate.csv")),
    loadCSV(bust(base + "assessment_turnaround_bins.csv")),
    loadCSV(bust(base + "engagement_index.csv")),
    loadCSV(bust(base + "at_risk_modules.csv"))
  ]);

  // ---- normalize risk ----
  function normalizeRisk(rows){
    const clean = (v) => (typeof v === "string" ? v.trim() : v);
    const TRUE_SET  = new Set(["true","1","yes","y"]);
    const FALSE_SET = new Set(["false","0","no","n",""]);
    const asBool = (v) => {
      const s = String(clean(v ?? "")).toLowerCase();
      if (TRUE_SET.has(s))  return true;
      if (FALSE_SET.has(s)) return false;
      return Boolean(v);
    };
    return (rows || [])
      .filter(r => r && r.module_id !== undefined && r.module_id !== "")
      .map(r => {
        const pass = clean(r.pass_rate   ?? r["pass_rate "]);
        const surv = clean(r.mean_survey ?? r["mean_survey "]);
        const flag = clean(r.at_risk     ?? r["at_risk "]);
        return {
          module_id: Number(clean(r.module_id)),
          pass_rate: pass === "" || pass == null ? null : Number(pass),
          mean_survey: surv === "" || surv == null ? null : Number(surv),
          at_risk: asBool(flag),
        };
      });
  }
  const riskClean = normalizeRisk(risk);

  // ---- KPIs ----
  function computeKPIs(pp, trn, e, rk){
    const overallPass = (
      pp.reduce((s,d)=>s+(+d.pass_rate_pct||0),0) / Math.max(pp.length,1)
    ).toFixed(1) + "%";
    const pctTurn15 = (
      trn.filter(d => ["<=10","11-15"].includes(String(d.turn_bin))).length /
      Math.max(trn.length,1) * 100
    ).toFixed(0) + "%";
    const engMed = e.map(d=>+d.engagement_index||0).sort((a,b)=>a-b)[Math.floor(e.length/2)];
    const riskCnt = riskClean.filter(d => d.at_risk === true).length;
    return { overallPass, pctTurn15, engMed: (engMed==null? "‚Äî" : engMed.toFixed(2)), riskCnt };
  }
  const k = computeKPIs(progPass, turn, eng, riskClean);
  document.getElementById("kpiPass").textContent = k.overallPass;
  document.getElementById("kpiTurn").textContent = k.pctTurn15;
  document.getElementById("kpiEng").textContent  = k.engMed;
  // We still display ‚ÄúAt-risk modules‚Äù inline in hero‚Äôs cards? We showed 3 mini KPIs there by design; keep 4th below:
  const extraKpi = document.createElement("div");
extraKpi.className = "mini";
extraKpi.innerHTML = `<div class="t">At‚Äërisk modules</div><div class="v" id="kpiRisk">${k.riskCnt}</div>`;
document.querySelector(".hero-kpis").appendChild(extraKpi);
  // (If you want it in hero, swap with one of the three mini cards.)

  // ---- Charts ----
  const groupBy = (arr, key) => arr.reduce((m,d)=>((m[d[key]]??=[]).push(d),m),{});

  // 1) Programme pass rates
  const byProg = groupBy(progPass, "programme");
  const traces1 = Object.entries(byProg).map(([name,rows]) => ({
    name, type:"scatter", mode:"lines+markers",
    x: rows.map(r=>r.term), y: rows.map(r=>r.pass_rate_pct)
  }));
  Plotly.newPlot("fig1", traces1, {
    xaxis:{title:"Term"}, yaxis:{title:"Pass rate (%)"},
    legend: bottomLegend(), margin:{t:10}
  });

  // 2) Turnaround distribution
  const bins = ["<=10","11-15","16-20",">20"];
  const counts = bins.map(b => turn.filter(d=>String(d.turn_bin)===b).length);
  Plotly.newPlot("fig2", [{x:bins,y:counts,type:"bar"}], {margin:{t:10}, showlegend:false});

  // 3) Engagement vs Pass
  const key = (p,t)=>`${p}|||${t}`;
  const engMap = new Map(eng.map(d=>[key(d.programme,d.term), d.engagement_index]));
  const merged = progPass.map(d=>({ ...d, engagement_index: engMap.get(key(d.programme,d.term)) }));
  Plotly.newPlot("fig3", [{
    x: merged.map(d=>d.engagement_index),
    y: merged.map(d=>d.pass_rate_pct),
    text: merged.map(d=>`${d.programme} ${d.term}`),
    mode:"markers", type:"scatter", name:""
  }], {xaxis:{title:"Engagement index"}, yaxis:{title:"Pass rate (%)"}, margin:{t:10}, showlegend:false});

  // 4) Modules: pass vs survey (at-risk vs higher)
  Plotly.newPlot("fig4", [
    {x: riskClean.filter(d=>d.at_risk).map(d=>d.mean_survey),
     y: riskClean.filter(d=>d.at_risk).map(d=>d.pass_rate),
     mode:"markers", name:"Low satisfaction & pass (at‚Äërisk)", marker:{color:"crimson"}},
    {x: riskClean.filter(d=>!d.at_risk).map(d=>d.mean_survey),
     y: riskClean.filter(d=>!d.at_risk).map(d=>d.pass_rate),
     mode:"markers", name:"Higher satisfaction", marker:{color:"seagreen"}}
  ], {xaxis:{title:"Survey score (1‚Äì5)"}, yaxis:{title:"Pass rate (%)"}, legend: bottomLegend(), margin:{t:10}});

  // 5) Segment #5 ‚Äî ‚â§ medians
  const engVals  = merged.map(d=>+d.engagement_index||0).sort((a,b)=>a-b);
  const passVals = merged.map(d=>+d.pass_rate_pct||0).sort((a,b)=>a-b);
  const medEng   = engVals[Math.floor(engVals.length/2)] || 0;
  const medPass  = passVals[Math.floor(passVals.length/2)] || 0;
  const seg5 = merged.filter(d => (+d.engagement_index||0) <= medEng && (+d.pass_rate_pct||0) <= medPass);
  Plotly.newPlot("fig5", [{
    x: seg5.map(d=>d.engagement_index),
    y: seg5.map(d=>d.pass_rate_pct),
    text: seg5.map(d=>`${d.programme} ${d.term}`),
    mode:"markers", name:""
  }], {
    shapes:[
      {type:"line", x0:medEng, x1:medEng, y0:0, y1:1, yref:"paper", line:{dash:"dot"}},
      {type:"line", y0:medPass, y1:medPass, x0:0, x1:1, xref:"paper", line:{dash:"dot"}}
    ],
    xaxis:{title:"Engagement index"}, yaxis:{title:"Pass rate (%)"},
    margin:{t:10}, showlegend:false
  });

  // 6) Modules ‚Äî ‚â§ median pass, split by at‚Äërisk
  const modPassMed = riskClean.map(d=>+d.pass_rate||0).sort((a,b)=>a-b)[Math.floor(riskClean.length/2)] || 0;
  const seg6 = riskClean.filter(d => (+d.pass_rate||0) <= modPassMed);
  Plotly.newPlot("fig6", [
    {x: seg6.filter(d=>d.at_risk).map(d=>d.mean_survey),
     y: seg6.filter(d=>d.at_risk).map(d=>d.pass_rate),
     mode:"markers", name:"Low satisfaction & pass (at‚Äërisk)", marker:{color:"crimson"}},
    {x: seg6.filter(d=>!d.at_risk).map(d=>d.mean_survey),
     y: seg6.filter(d=>!d.at_risk).map(d=>d.pass_rate),
     mode:"markers", name:"Higher satisfaction", marker:{color:"seagreen"}}
  ], {
    shapes:[{type:"line", y0:modPassMed, y1:modPassMed, x0:0, x1:1, xref:"paper", line:{dash:"dot"}}],
    xaxis:{title:"Survey score (1‚Äì5)"}, yaxis:{title:"Pass rate (%)"},
    legend: bottomLegend(), margin:{t:10}
  });

  // ---- Table (null-safe) ----
  const cols = [
  { title:"module_id", data:"module_id", defaultContent:"‚Äî" },
  { title:"pass_rate", data:"pass_rate", defaultContent:"‚Äî",
    render: d => d == null ? "‚Äî" : (+d).toFixed(2) },
  { title:"mean_survey", data:"mean_survey", defaultContent:"‚Äî",
    render: d => d == null ? "‚Äî" : (+d).toFixed(2) },
  { title:"at_risk", data:"at_risk", defaultContent:"‚Äî" }
];
  if ($.fn.dataTable.isDataTable("#modTable")) $("#modTable").DataTable().destroy();
  $("#modTable").empty();
  $("#modTable").DataTable({ data: riskClean, columns: cols, pageLength: 10, order: [[1,"asc"]] });
})();
</script>
</body>
</html>